<?php

namespace App\Entity;

use App\Repository\VulnerabilityRepository;
use Doctrine\DBAL\Types\Types;
use Doctrine\ORM\Mapping as ORM;
use Symfony\Component\Uid\Uuid;

#[ORM\Entity(repositoryClass: VulnerabilityRepository::class)]
#[ORM\HasLifecycleCallbacks]
#[ORM\Index(columns: ['scan_id'], name: 'idx_vulnerability_scan')]
#[ORM\Index(columns: ['cve'], name: 'idx_vulnerability_cve')]
class Vulnerability
{
    #[ORM\Id]
    #[ORM\Column(type: 'uuid', unique: true)]
    private ?Uuid $id = null;

    #[ORM\ManyToOne(targetEntity: RepositoryScan::class, inversedBy: 'vulnerabilities')]
    #[ORM\JoinColumn(nullable: false, onDelete: 'CASCADE')]
    private ?RepositoryScan $scan = null;

    #[ORM\Column(length: 1024)]
    private ?string $title = null;

    #[ORM\Column(length: 128, nullable: true)]
    private ?string $cve = null;

    #[ORM\Column(length: 64, nullable: true)]
    private ?string $severity = null;

    #[ORM\Column(type: Types::DECIMAL, precision: 5, scale: 2, nullable: true)]
    private ?string $score = null;

    #[ORM\Column(length: 256, nullable: true)]
    private ?string $fixedIn = null;

    #[ORM\Column(name: '`references`', type: Types::JSON, nullable: true)]
    private ?array $references = null;

    #[ORM\Column]
    private ?bool $ignored = false;

    #[ORM\Column(length: 1024, nullable: true)]
    private ?string $packageName = null;

    #[ORM\Column(length: 256, nullable: true)]
    private ?string $packageVersion = null;

    #[ORM\Column(length: 128, nullable: true)]
    private ?string $ecosystem = null;

    #[ORM\Column(type: Types::JSON, nullable: true)]
    private ?array $packageMetadata = null;

    #[ORM\Column(type: Types::DATETIME_IMMUTABLE)]
    private ?\DateTimeImmutable $createdAt = null;

    #[ORM\Column(type: Types::DATETIME_MUTABLE, nullable: true)]
    private ?\DateTime $updatedAt = null;

    public function __construct()
    {
        $this->id = Uuid::v4();
    }

    #[ORM\PrePersist]
    public function setCreatedAtValue(): void
    {
        $this->createdAt = new \DateTimeImmutable();
    }

    #[ORM\PreUpdate]
    public function setUpdatedAtValue(): void
    {
        $this->updatedAt = new \DateTime();
    }

    public function getId(): ?Uuid
    {
        return $this->id;
    }

    public function getScan(): ?RepositoryScan
    {
        return $this->scan;
    }

    public function setScan(?RepositoryScan $scan): static
    {
        $this->scan = $scan;

        return $this;
    }

    public function getTitle(): ?string
    {
        return $this->title;
    }

    public function setTitle(string $title): static
    {
        $this->title = $title;

        return $this;
    }

    public function getCve(): ?string
    {
        return $this->cve;
    }

    public function setCve(?string $cve): static
    {
        $this->cve = $cve;

        return $this;
    }

    public function getSeverity(): ?string
    {
        return $this->severity;
    }

    public function setSeverity(?string $severity): static
    {
        $this->severity = $severity;

        return $this;
    }

    public function getScore(): ?string
    {
        return $this->score;
    }

    public function setScore(?string $score): static
    {
        $this->score = $score;

        return $this;
    }

    public function getFixedIn(): ?string
    {
        return $this->fixedIn;
    }

    public function setFixedIn(?string $fixedIn): static
    {
        $this->fixedIn = $fixedIn;

        return $this;
    }

    public function getReferences(): ?array
    {
        return $this->references;
    }

    public function setReferences(?array $references): static
    {
        $this->references = $references;

        return $this;
    }

    public function isIgnored(): ?bool
    {
        return $this->ignored;
    }

    public function setIgnored(bool $ignored): static
    {
        $this->ignored = $ignored;

        return $this;
    }

    public function getPackageName(): ?string
    {
        return $this->packageName;
    }

    public function setPackageName(?string $packageName): static
    {
        $this->packageName = $packageName;

        return $this;
    }

    public function getPackageVersion(): ?string
    {
        return $this->packageVersion;
    }

    public function setPackageVersion(?string $packageVersion): static
    {
        $this->packageVersion = $packageVersion;

        return $this;
    }

    public function getEcosystem(): ?string
    {
        return $this->ecosystem;
    }

    public function setEcosystem(?string $ecosystem): static
    {
        $this->ecosystem = $ecosystem;

        return $this;
    }

    public function getPackageMetadata(): ?array
    {
        return $this->packageMetadata;
    }

    public function setPackageMetadata(?array $packageMetadata): static
    {
        $this->packageMetadata = $packageMetadata;

        return $this;
    }

    public function getCreatedAt(): ?\DateTimeImmutable
    {
        return $this->createdAt;
    }

    public function getUpdatedAt(): ?\DateTime
    {
        return $this->updatedAt;
    }
}
